<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Projeto Hildegarda</title>
  <style>
    @font-face {
      font-family: "Deutsch Gothic";
      src: url("fonts/Deutsch.ttf") format("woff2");
    }
    body {
      background: radial-gradient(circle at center, #111 0%, #000000 100%);
      color: white;
      font-family: 'Deutsch Gothic';
      text-align: center;
      overflow: hidden;
      height: 100vh;
      margin: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    h1 {
      margin-bottom: 18px;
      background: #C79845;
      border: outset;
      font-family: "Deutsch Gothic";
      font-size: 2rem;
      letter-spacing: .15rem;
      padding: 10px 20px;
      border-radius: 10px;
    }

    #colorAura {
      position: relative;
      margin: 50px;
      width: 700px;
      height: 700px;
    }

    button {
      background: #3a3a3a;
      font-family: "Deutsch Gothic";
      letter-spacing: .1rem;
      border: outset;
      color: white;
      padding: 10px 20px;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 20px;
      transition: background 0.5s;
    }

    button:hover {
      background: #5f5f5f;
    }
  </style>
</head>
<body>
  <h1>Projeto Hildegarda</h1>
  <div id="colorAura"></div>
  <button id="playBtn">Reproduzir</button>

  <script type="module">
    import * as Tone from "https://cdn.skypack.dev/tone";

    const colors = [
      "rgba(75, 0, 130, 0.7)",   // índigo
      "rgba(0, 0, 255, 0.7)",    // azul
      "rgba(0, 127, 255, 0.7)",  // azul claro / ciano
      "rgba(0, 128, 0, 0.7)",    // verde
      "rgba(255, 255, 0, 0.7)",  // amarelo
      "rgba(255, 83, 0, 0.7)",  // laranja
      "rgba(255, 42, 0, 0.7)",   // laranja avermelhado
      "rgba(255, 0, 0, 0.7)"     // vermelho
    ];

    const colorAura = document.getElementById("colorAura");

    // Cria os 7 círculos coloridos dispostos em círculo
    const radius = 250;
    const notes = ["C", "D", "E", "F", "G", "A", "Bb", "B"];

    const synth = new Tone.Synth({ oscillator: { type: "sine" } }).toDestination();

    function activateCircle(note, duration) {
      note = note.replace(/\d+/, '');
      const i = notes.indexOf(note);
      if (i === -1) return;

      const circle = document.createElement("div");
      circle.note = notes[i];
      circle.className = "circle";
      circle.style.background = `radial-gradient(circle, ${colors[i % colors.length]} 0%, transparent 70%)`;

      const angle = (i / colors.length) * 2 * Math.PI;
      const x = Math.cos(angle) * radius;
      const y = Math.sin(angle) * radius;

      circle.style.left = `calc(50% + ${x}px)`;
      circle.style.top = `calc(50% + ${y}px)`;
      circle.style.position = "absolute";
      circle.style["border-radius"] = "50%";
      circle.style.filter = "blur(3px) brightness(2)";
      circle.style.width = "80px";
      circle.style.height = "80px";
      circle.style["mix-blend-mode"] = "screen";
      circle.style.transform = "translate(-50%, -50%) scale(0)"
      circle.style.transition = "transform 1.5s ease, opacity 1s ease";

      colorAura.appendChild(circle);

      setTimeout(() => {
        circle.style.transform = "translate(-50%, -50%) scale(50)";
        circle.style.opacity = "0.7";
      }, 50);
      setTimeout(() => {
        circle.style.opacity = "0";
      }, duration);
      
      setTimeout(() => circle.remove(), duration + 1000);
    }

    //const melody = ["F4", "D4", "E4", "F4.", "G4", "A4", "G4", "A4", "A4", "Bb4", "A4", "G4.", "F4.", "A4", "Bb4", "A4", "G4.", "E4.", "G4", "A4", "G4", "F4", "E4", "F4.", "G4", "F4.", "E4."];
    /*const melody = ["D4", "D4", "F4", "D4", "F4", "F4.", 
      "D4", "E4", "D4.", "F4", "E4", "F4", 
      "G4", "G4", "G4", "F4", "E4", "F4", 
      "G4", "F4", "G4.", "G4.", "F4.", 
      "D4", "F4", "E4", "E4", "G4", "F4.", 
      "F4.", "E4."
    ];*/
    /*const melody = [
      "D4", "F4.", "F4.", "E4", "F4.", "A4", 
      "Bb4", "A4", "G4", "F4.", "E4", 
      "G4", "A4", "G4", "F4", "G4", "E4", "F4.", 
      "D4", "D4", "F4", "A4", "G4", 
      "D4", "F4", "A4", "G4", "F4", "G4", "E4", "F4.", 
      "D4", "A4", "G4", "F4", "G4", "E4", 
      "E4", "G4", "F4", "G4", "F4.", 
      "E4."
    ];*/
    const melody = [
      "F4", "G4", "F4", "G4", "A4.", 
      "Bb4", "A4", "G4.", "Bb4", "A4", "G4", "F4.", 
      "F4", "C5.", 
      "C5", "D5", "C5", "Bb4", "A4", "F4", "G4", "A4.", 
      "Bb4", "A4", "G4", "F4.", 
      "C5", "C5", "D5", "C5.", 
      "C5", "F4", "G4", "F4.", 
      "G4", "A4", "Bb4", "C5.", 
      "C5", "F4", "G4", "Bb4", "A4", "G4", "F4.", 
      "E4", "G4", "G4.", 
      "F4."
    ];
    async function playSequence() {
      await Tone.start();
      let time = 0;
      for (let i = 0; i < melody.length; i++) {
        const note = melody[i];
        const duration = note.includes('.')? '2n' : '4n';
        const cleanNote = note.replace('.', '');
        synth.triggerAttackRelease(cleanNote, duration, Tone.now() + time);
        setTimeout(() => activateCircle(cleanNote, duration === '4n'? 500: 1000), time * 1000);
        time += duration === '4n'? 0.5 : 1;
      }
    }

    document.getElementById("playBtn").addEventListener("click", playSequence);
  </script>
</body>
</html>
